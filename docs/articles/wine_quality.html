<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case study: wine quality • live</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/wine_quality.html">Case study: wine quality</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MI2DataLab/live">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Case study: wine quality</h1>
                        <h4 class="author">Mateusz Staniak</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MI2DataLab/live/blob/master/vignettes/wine_quality.Rmd"><code>vignettes/wine_quality.Rmd</code></a></small>
      <div class="hidden name"><code>wine_quality.Rmd</code></div>

    </div>

    
    
<div id="live-package-use-case-wine-quality-data" class="section level1">
<h1 class="hasAnchor">
<a href="#live-package-use-case-wine-quality-data" class="anchor"></a><code>live</code> package use case: wine quality data</h1>
<p>The <code>live</code> package approximates black box model (here SVM model) with a simpler white box model (here linear regression model) to explain the local structure of a black box model and in consequence to assess how features contribute into a single prediction.</p>
<div id="about-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#about-the-data" class="anchor"></a>About the data</h2>
<p>The wine quality data is a well-known dataset which is commonly used as an example in predictive modeling. The main objective associated with this dataset is to predict the quality of some variants of Portuguese ,,Vinho Verde’’ based on 11 chemical properties. According to the results from the original article, the Support Vector Machine (SVM) model performs better than other models including linear regression, neural networks and others. We will explain the prediction for the fifth case in the dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wine[<span class="dv">5</span>, ]</code></pre></div>
<pre><code>## # A tibble: 1 x 12
##   fixed_acidity volatile_acidity citric_acid residual_sugar chlorides
##           &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
## 1          7.40            0.700          0.           1.90    0.0760
## # ... with 7 more variables: free_sulfur_dioxide &lt;dbl&gt;,
## #   total_sulfur_dioxide &lt;dbl&gt;, density &lt;dbl&gt;, pH &lt;dbl&gt;, sulphates &lt;dbl&gt;,
## #   alcohol &lt;dbl&gt;, quality &lt;int&gt;</code></pre>
</div>
<div id="explaining-the-prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#explaining-the-prediction" class="anchor"></a>Explaining the prediction</h2>
<p>Once we have the fitted model, we need to generate artificial observations around the selected observation for local exploration. We use <code>sample_locally2</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wine_svm &lt;-<span class="st"> </span>e1071<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/e1071/topics/svm">svm</a></span>(quality <span class="op">~</span>., <span class="dt">data =</span> wine)

similar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_locally2.html">sample_locally2</a></span>(<span class="dt">data =</span> wine,
                           <span class="dt">explained_instance =</span> wine[<span class="dv">5</span>, ],
                           <span class="dt">explained_var =</span> <span class="st">"quality"</span>,
                           <span class="dt">size =</span> <span class="dv">500</span>)</code></pre></div>
<p>This function generates observations that are similar to the observation of interest. Their number is controled by <code>size</code> argument. Two method of sampling are available through <code>method</code> argument. Method “live” changes a value of one variable per new observations, method “lime” permutes each column. Object returned by the function is a list that contains the dataset, name of the target variable and the explained instance.</p>
<p>The next step is adding black box model predictions to the similar observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">similar1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_predictions2.html">add_predictions2</a></span>(<span class="dt">to_explain =</span> similar,
                             <span class="dt">black_box_model =</span> wine_svm)</code></pre></div>
<p>If multiple models are to be explained, there is no need to generate multiple <em>artificial</em> datasets. Predictions of each model on a single simulated dataset can be added with the use of <code>add_predictions2</code> function. A different object should be created for each model, but the same result of a call to <code>sample_locally2</code> function should be used a <code>to_explain</code> argument. Black box model can be passed as a model object or as a name of  learner. While the object created by <code>sample_locally2</code> function stores the dataset, explained instance and the name of the response variable, object returned by <code>add_predictions2</code> function also stores the fitted black box model. The result of applying <code>sample_locally2</code> functions doesn’t contain the response and the result of <code>add_predictions2</code> contains a column with model predictions, which has the same name as response in original dataset. If a <code>mlr</code> name of a black box model is passed, dataset to train the model needs to be provided, too.</p>
<p>Once the artificial data points around the case of interest are generated, we may fit the white box model to them. Here we fit linear regression model using <code>fit_explanation2</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wine_expl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_explanation2.html">fit_explanation2</a></span>(<span class="dt">live_object =</span> similar1,
                              <span class="dt">white_box =</span> <span class="st">"regr.lm"</span>)</code></pre></div>
<p>This function returns a native <code>mlr</code> object. Model object (for example lm object) can be extracted with the use of <code>getLearnerModel</code> function from <code>mlr</code>. For datasets with larger number of variables, we could obtain sparse results by setting <code>selection = TRUE</code> in the <code>fit_explanation2</code> function. With this option variable selection based on LASSO implemented in <code>glmnet</code> package is performed. Features can be standardize before fitting explanation model by setting <code>standardize</code> argument to <code>TRUE</code>. When using Generalized Linear Model as a white box model it is possible to set <code>family</code> argument to one of the distribution families available in <code>glm</code> and <code>glmnet</code> functions via <code>response_family</code> argument to <code>fit_explanation2</code>. Moreover, for explanation models that support weights, observation can be weighted according to their distance from the explained instance. This behavior is controlled via <code>kernel</code> argument. Default kernel is gaussian kernel. If observations do not need to be weighted, <code>identity_kernel</code> can be used. User can define his own kernels, which are simply a function of two arguments that return a single number.</p>
<p>The white box model <code>wine_expl</code> approximates the black box model <code>wine_svm</code> around the selected observation. Now we can visualize it with the generic <code>plot</code> function. If the model chosen as the white box has a <code>plot</code> method, the function will call it on the appropriate object. Two special plots are available for regression problems.</p>
<p><em>Forest plot</em> from <code>forestmodel</code> package focuses on the local structure of the model by plotting estimates of the regressions coefficients along with confidence intervals and p-values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(wine_expl, <span class="dt">type =</span> <span class="st">"forest"</span>)</code></pre></div>
<p><img src="wine_quality_files/figure-html/forestplot-1.png" width="672"></p>
<p><em>Break Down Plots</em> or waterfall plots from <code>breakDown</code> package display how predictors contribute to the prediction. For details see <code>breakDown</code> documentation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(wine_expl, <span class="dt">type =</span> <span class="st">"waterfall"</span>)</code></pre></div>
<p><img src="wine_quality_files/figure-html/waterfallplot-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#live-package-use-case-wine-quality-data"><code>live</code> package use case: wine quality data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#about-the-data">About the data</a></li>
      <li><a href="#explaining-the-prediction">Explaining the prediction</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mateusz Staniak, Przemysław Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
